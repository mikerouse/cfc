{% extends "base.html" %}
{% block title %}{{ council.name }} - Council Finance Counters{% endblock %}
{% block content %}
<h1 class="text-2xl font-bold mb-4">{{ council.name }}</h1>
<p>Slug: {{ council.slug }}</p>
{% if council.website %}
<p>Website: <a href="{{ council.website }}" class="text-blue-700 hover:underline">{{ council.website }}</a></p>
{% endif %}
{% if council.council_type %}
<p>Type: {{ council.council_type.name }}</p>
{% endif %}
{% if counters %}
<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 my-6">
    {% for item in counters %}
    <div class="bg-green-50 p-4 rounded shadow text-center">
        <p class="text-sm text-gray-600">{{ item.counter.name }}</p>
        <p class="text-2xl font-bold" data-duration="{{ item.counter.duration }}" data-value="{{ item.value }}" data-formatted="{{ item.formatted }}">0</p>
        <p class="text-xs mt-1">{{ item.counter.explanation }}</p>
    </div>
    {% endfor %}
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/countup.js/2.6.2/countUp.umd.js"></script>
<script>
// Animate all counter elements using CountUp for smoother number transitions.
document.querySelectorAll('[data-duration]').forEach(el => {
    const end = parseFloat(el.dataset.value || '0');
    const duration = parseInt(el.dataset.duration || '0') / 1000; // ms -> seconds
    const display = el.dataset.formatted || end.toLocaleString();
    const counter = new window.CountUp(el, end, {duration});
    if (!counter.error) {
        counter.start(() => {
            // Ensure the final formatted string matches server-side formatting.
            el.textContent = display;
        });
    } else {
        el.textContent = display;
    }
});
</script>
{% endif %}
{% if figures %}
<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 my-6">
    {% for fig in figures %}
    <div class="bg-blue-50 p-4 rounded shadow text-center">
        <p class="text-sm text-gray-600">{{ fig.year.label }} - {{ fig.field_name|capfirst }}</p>
        <p class="text-2xl font-bold">{{ fig.value }}</p>
    </div>
    {% endfor %}
</div>
{% endif %}
<p class="mt-4"><a href="{% url 'council_list' %}" class="text-blue-700 hover:underline">Back to all councils</a></p>
{% endblock %}

