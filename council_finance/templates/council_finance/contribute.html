{% extends "base.html" %}
{% load static %}
{% block title %}Contribute - Council Finance Counters{% endblock %}
{% block content %}
<h1 class="text-2xl font-bold mb-4">Contribute Data</h1>
<div id="contrib-msg" class="text-green-700 mb-4 hidden" role="status"></div>
{% if points is not None %}
<p class="mb-4" aria-live="polite">You have {{ points }} points and rank {{ rank }} on the leaderboard.</p>
{% endif %}
<div class="flex gap-4">
  <div class="flex-1">
    <h2 class="sr-only">Missing Characteristics</h2>
    <div class="mb-2 flex gap-2 items-end">
      <input id="issues-search" type="text" placeholder="Search..." class="border rounded px-2 py-1" />
      <select id="issues-type" class="border rounded px-2 py-1">
        <option value="missing">Missing Financial</option>
        <option value="missing" data-category="characteristic">Missing Characteristics</option>
        <option value="suspicious">Suspicious</option>
        <option value="pending">Pending Approval</option>
      </select>
      <select id="issues-size" class="border rounded px-2 py-1">
        <option value="25">25</option>
        <option value="50" selected>50</option>
        <option value="100">100</option>
      </select>
    </div>
    <div id="issues-data-container" data-page="1" data-order="council" data-dir="asc" data-page-size="50">
      {% include 'council_finance/data_issues_table.html' with page_obj=page_obj paginator=paginator issue_type='missing' show_year=True %}
    </div>
    <h2 class="sr-only">Missing Financial Data</h2>
    <div class="hidden" id="initial-financial-data">
      {% include 'council_finance/data_issues_table.html' with page_obj=missing_financial_page paginator=missing_financial_paginator issue_type='missing' show_year=True %}
    </div>
  </div>
  <aside id="moderator-panel" class="w-64 hidden md:block"></aside>
</div>

{% include 'council_finance/modals.html' %}
<script src="{% static 'js/data_issues.js' %}"></script>
<script>
// Simple tutorial shown once
if (!localStorage.getItem('seenTutorial')) {
  alert('Use this table to add or review council data. Moderators see extra actions.');
  localStorage.setItem('seenTutorial', '1');
}
document.getElementById('edit-cancel').addEventListener('click', () => document.getElementById('edit-modal').classList.add('hidden'));
document.getElementById('reject-cancel').addEventListener('click', () => document.getElementById('reject-modal').classList.add('hidden'));
document.getElementById('add-cancel').addEventListener('click', () => document.getElementById('add-value-modal').classList.add('hidden'));
document.addEventListener('issueTableUpdated', () => {
  document.querySelectorAll('.reject-btn').forEach(btn => {
    btn.onclick = e => { e.preventDefault(); document.getElementById('reject-form').action = btn.dataset.url; document.getElementById('reject-modal').classList.remove('hidden');};
  });
});
</script>
{% endblock %}
