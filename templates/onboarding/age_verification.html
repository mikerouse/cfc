{% extends "base.html" %}
{% load static %}

{% block title %}Age Verification - Council Finance Counters{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto py-8 px-4">
    <!-- Progress indicator -->
    <div class="mb-8">
        <div class="flex items-center justify-between text-sm text-gray-600 mb-2">
            <span>Step {{ progress.current|default:"?" }} of {{ progress.total|default:"?" }}</span>
            <span>{{ progress.percent|default:"?" }}% complete</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" 
                 style="width: {{ progress.percent }}%"></div>
        </div>
    </div>

    <!-- Age verification form -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">
            Verify your age
        </h1>
        
        <!-- OSA compliance explanation -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <svg class="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div class="ml-3">
                    <h3 class="text-lg font-medium text-blue-900 mb-2">
                        Why we need this information
                    </h3>
                    <div class="text-blue-800 space-y-2">
                        <p>The <strong>Online Safety Act</strong> requires us to verify the age of our users to ensure appropriate content is shown.</p>
                        <p>Your date of birth helps us:</p>
                        <ul class="list-disc ml-6 space-y-1">
                            <li>Comply with legal requirements</li>
                            <li>Provide age-appropriate features</li>
                            <li>Keep users under 18 safe from potentially harmful content</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form errors -->
        {% if form.non_field_errors %}
            <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6" role="alert">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-red-800">There is a problem</h3>
                        <div class="mt-2 text-sm text-red-700">
                            {{ form.non_field_errors }}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        <form method="post" novalidate>
            {% csrf_token %}
            
            <div class="space-y-6">
                <!-- Date of birth field -->
                <div class="form-group{% if form.date_of_birth.errors %} error{% endif %}">
                    <label for="{{ form.date_of_birth.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        Date of birth
                        <span class="text-red-500">*</span>
                    </label>
                    
                    {% if form.date_of_birth.errors %}
                        <div class="mb-2">
                            {% for error in form.date_of_birth.errors %}
                                <span class="text-sm text-red-600">{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                    
                    <div class="mt-1">
                        {{ form.date_of_birth }}
                    </div>
                    
                    {% if form.date_of_birth.help_text %}
                        <p class="mt-2 text-sm text-gray-500">{{ form.date_of_birth.help_text }}</p>
                    {% endif %}
                </div>

                <!-- Privacy notice -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                    <h3 class="text-sm font-medium text-gray-900 mb-2">Your privacy</h3>
                    <p class="text-sm text-gray-700">
                        We store your date of birth securely and only use it to calculate your age for legal compliance. 
                        We never share this information with third parties, and you can delete your account at any time.
                    </p>
                </div>
            </div>

            <!-- Form actions -->
            <div class="flex items-center justify-between pt-6 mt-8 border-t border-gray-200">
                <a href="{% url 'onboarding_details' %}" 
                   class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    <svg class="mr-2 -ml-1 w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.707 14.707a1 1 0 01-1.414 0L2.586 11H10a1 1 0 010 2H2.586l3.707 3.707a1 1 0 11-1.414 1.414L.172 13.414A2 2 0 010 12a2 2 0 01.172-1.414L4.879.879a1 1 0 111.414 1.414L2.586 10H10a1 1 0 010 2L7.707 14.707z" clip-rule="evenodd"></path>
                    </svg>
                    Back
                </a>
                
                <button type="submit" 
                        class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                    Continue
                    <svg class="ml-2 -mr-1 w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// Add some client-side validation and UX improvements
document.addEventListener('DOMContentLoaded', function() {
    const dobField = document.querySelector('input[type="date"]');
    
    if (dobField) {
        // Ensure Tailwind styles are applied
        dobField.classList.add('block', 'w-full', 'px-3', 'py-2', 'border', 'border-gray-300', 'rounded-md', 'shadow-sm', 'focus:outline-none', 'focus:ring-blue-500', 'focus:border-blue-500', 'text-lg');
        
        // Add error styling if there are errors
        const hasErrors = document.querySelector('.form-group.error');
        if (hasErrors) {
            dobField.classList.add('border-red-300', 'focus:ring-red-500', 'focus:border-red-500');
            dobField.classList.remove('border-gray-300', 'focus:ring-blue-500', 'focus:border-blue-500');
        }
    }
});
</script>
{% endblock %}